
# Telegam-бот Дворецкий
## Мотивация
В процессе работы над проектом [мы осознали](https://wiki.skbkontur.ru/pages/viewpage.action?pageId=403489315),
что нам неудобно отслеживать изменения в Merge-Request'ах на гитлабе: забываются MR, на которых мы не поставили лайк,
забываем делать повторное ревью после того, как нам ответили или поправили и тд и тп

Уведомления на почту не помогают

Поэтому решили создать телеграм-бота, который будет напоминать нам об этих вещах и в перспективе брать на себе больше ответственности

## Облик бота
Название бота - Дворецкий, тк он выполняет роль вежливого помощника

Поведение соответствует роли: он общается обходительно, обращаясь к собеседнику "Сэр" (пока нет девушек в разработке, должно быть ок)

## Текущая функциональность и команды

### Регулярные оповещение
Бот регулярно опрашивает GitLab на наличие открытых MR и раз в сутки днём отправляет сообщения пользователям, которые не лайкнули MR

### /start
Стартует бота

Бот приветствует пользователя и рассказывает о себе

### /email почта
Позволяет настроить соответствие своей почты с гитлаб и чата в Телеграме

Примечание: сейчас решается не почтой, а userName с гитлаба, тк так проще общаться с апихой

### /list
Бот выводит список MR, которые не получили лайк от данного собеседника

Если он не знает гитлабовский userName собеседника, он просит выполнить /email

## Технические тонкости
Для взаимодействия с Телеграмом используем web-hook, при старте сервиса сообщаем боту, где мы захостились и путь к /api/update

Бот шлет POST-запросы на указанный web-hook, мы обязаны хоститься через https

Для общения с гитлабом используем клиент к их апихе из nuget

Для фоновых задач (конфигурирование бота при старте, регулярные уведомления) используем HostedService из ASP.NET Core

Токен бота и гитлаба храним в секретных настройках

Нужно хранить базу пользователей, чтобы определять соответствие чату в телеграме и нику в гитлабе, на данном этапе используем json-файлик с горячими настройками

## Конфигурация и запуск

Для успешного старта бота необходимо указать токены в json в разделе "Credentials"

В Bot.WebHookPath необходимо указать полный url хоста с ресурсом /api/update (например, https://3cf7fbc4aa27.ngrok.io/api/update)